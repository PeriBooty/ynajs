var Yna=function(n,e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;const r=class{constructor(n,e,t){this.name=n,this.options=e,this.data=t}log(n,e){if(this.options.debug){const t=[this.name,...n].join("::");console.log(`${t}: ${JSON.stringify(e)}`)}}},o=(n,e)=>`<${n}:${e.message}>`,s=(e,t="unknown")=>{if(n.isString(e))return e;if(!0===e)return"True";if(!1===e)return"False";if(n.isNil(e))return"None";if(n.isError(e))return o(t,e);return String(e)},i=(n,e)=>{let t=0;n.split("").forEach((n,r)=>{const o={open:"{"===n,close:"}"===n};o.open?t++:o.close&&t--;e(n,r,t,o)});return t},c=class extends r{constructor(n,e){super("PARSER",n,e)}parseString(n,e=!0){const t=[];let r,s,c=0;const u=i(n,(e,r,o,s)=>{const i=n.substr(c,r-c);s.open&&1===o?(t.push(i),c=r):s.close&&0===o&&(t.push(this.parseBlock(i.substr(1,i.length-1))),c=r+1)});if(t.push(n.substr(c)),0!==u)r=o("parser",new Error("mismatched brackets")),s="error";else{const n=e?t.filter(n=>n.length>0):t;1===n.length?(r=n[0],s="single"):(r=n,s="mixed")}return this.log(["string",s],r),r}parseBlock(n){const e=n.trim();let t,r;if(e.startsWith("!")){const e="{"+n.replace("!","")+"}";t=[2,e],r="comment"}else if(e.startsWith(">")){const e="{"+n.replace(">","")+"}";t=e,r="escaped"}else if(e.endsWith(";")){const e=this.parseBlockData(n);t=[1,e.name,e.args],r="command"}else{const e=this.parseString(n);t=[0,e],r="key"}return this.log(["block",r],t),t}parseBlockData(n){const e=[],t={name:"",args:""};let r,s=0,c=!1;return 0!==i(n,(t,r,o)=>{if(0===o&&(";"===t||":"===t&&!c)){const o=this.parseString(n.substr(s,r-s),!0);e.push(o),s=r+1,":"===t&&(c=!0)}})?(t.name=e[0],t.args=o("parser",new Error("mismatched brackets")),r="error"):(t.name=e[0],t.args=e.slice(1),r="mixed"),this.log(["strData",r],t),t}},u={debug:!1,loadJSON:!1},a={debug:!1,depth:0},f={},g=/^-?\d+\.?\d*$/,h=parseFloat,l=n=>g.test(String(n)),m=Math.pow(2,32)-1,d=1-Math.pow(2,32),p=n.mapFromObject({add:{argsLengthRange:[2,1/0],fn:(...n)=>n.reduce((n,e)=>n+e)},sub:{argsLengthRange:[2,2],fn:(...n)=>n.reduce((n,e)=>n-e)},mul:{argsLengthRange:[2,1/0],fn:(...n)=>n.reduce((n,e)=>n*e)},pow:{argsLengthRange:[2,2],fn:Math.pow},div:{argsLengthRange:[2,2],fn:(n,e)=>0!==e?n/e:new Error("divide by zero")},idiv:{argsLengthRange:[2,2],fn:(n,e)=>0!==e?Math.floor(n/e):new Error("divide by zero")},mod:{argsLengthRange:[2,2],fn:(n,e)=>n%e},and:{argsLengthRange:[2,1/0],fn:(...n)=>[-1,...n].reduce((n,e)=>n&e)},or:{argsLengthRange:[2,1/0],fn:(...n)=>[0,...n].reduce((n,e)=>n|e)},xor:{argsLengthRange:[2,2],fn:(n,e)=>n^e},not:{argsLengthRange:[1,1],fn:n=>~n},round:{argsLengthRange:[1,1],fn:Math.round},floor:{argsLengthRange:[1,1],fn:Math.floor},ceil:{argsLengthRange:[1,1],fn:Math.ceil},max:{argsLengthRange:[2,1/0],fn:Math.max},min:{argsLengthRange:[2,1/0],fn:Math.min}}),w=n.mapFromObject({"+":"add","-":"sub","*":"mul","**":"pow","/":"div","/f":"div","//":"idiv","%":"mod","&":"and","|":"or","^":"xor","~":"not"}),E=(n,e)=>{if(0===e.length)return new Error("no args");const t=n.execItem(e[0]);const r=e.slice(1);let o;let s;let i;if(p.has(t))o=p.get(t);else{if(!w.has(t))return new Error("unknown operation");o=p.get(w.get(t))}if(!(r.length>=o.argsLengthRange[0]&&r.length<=o.argsLengthRange[1]))return new Error("invalid args");s=n.execArr(r);if(s.some(n=>!l(n)))return new Error("non-number args");s=s.map(h);i=o.fn(...s);if(i>m)return new Error("inf");if(i<d)return new Error("-inf");return i},b=(e,t)=>{if(0===t.length)return new Error("no options");const r=e.execArr(t);return n.randItem(r)},x=(e,t)=>{if(0===t.length)return new Error("no args");const r=e.execArr(t);if(!r.every(l))return new Error("invalid args");let o=0;let s=100;let i=1;1===r.length?s=h(r[0]):(o=h(r[0]),s=h(r[1]));3===r.length&&(i=h(r[2]));if(o===s||0===i)return new Error("invalid range");const c=n.randNumber(o,s,!Number.isInteger(i));return Math.floor(c/i)*i},R=(e,t)=>{if(0===t.length)return new Error("no options");if(t.length%2!=0)return new Error("mismatched weighting");const r=e.execArr(t);const o=[];const s=[];let i=!0;r.forEach((n,e)=>{e%2==0?s.push(n):l(n)?o.push(h(n)):i=!1});if(!i)return new Error("invalid weight");const c=[];o.forEach((n,e)=>{const t=s[e];const r=new Array(n).fill(t);c.push(...r)});return n.randItem(c)},y=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.length},L=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.toLowerCase()},v=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return encodeURI(t)},k=(n,e)=>{if(0===e.length)return new Error("no content");if(3!==e.length)return new Error("invalid args");const t=n.execArr(e);const r=n.keys.get("newrep");const o=t[0];const s=r?t[2]:t[1];const i=r?t[1]:t[2];const c=new RegExp(o,"g");return s.replace(c,i)},S=n=>n.split(","),I=n=>n.includes(","),M=(n,t)=>{if(0===t.length)return new Error("no args");if(2!==t.length)return new Error("bad content");const r=n.execArr(t);const o=r[1];const s=I(r[0])?S(r[0]):[r[0]];if(s.length>3)return new Error("too many nums");if(!s.every(n=>l(n)||""===n))return new Error("non int index");const i=s.map(n=>""!==n&&h(n));if(0===i[2])return new Error("zero step");return!1===i[2]?e(o,i[0],i[1]):e(o,i[0],i[1],i[2])},j=/\s/,D=n=>{let e=!0;return n.split("").map(n=>{const t=j.test(n);let r=n.toLowerCase();e&&!t&&(e=!1,r=n.toUpperCase());e=t;return r}).join("")},A=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return D(t)},N=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.toUpperCase()},O=()=>{const e=n.mapFromObject({math:E,len:y,upper:N,lower:L,title:A,rep:k,parse:v,slice:M,num:x,choose:b,wchoose:R});return e},F=n=>t.utc(n).format("YYYY-MM-DD HH:mm:ss:SSSSSS"),C=(e,r)=>{const o=new Map;o.set("time",F(t.utc()));o.set("newrep",!1);o.set("args",e.join(" "));o.set("arglen",e.length);e.forEach((n,e)=>{o.set(`arg${e+1}`,n)});n.forEachEntry(r,(n,e)=>{o.set(e,n)});return o},P=n=>n,Y=class extends r{constructor(n,e,t,r){super("RUNNER",t,r),this.commands=n,this.keys=e,this.transformer=P}execItem(e,t){const r=e[0],o=e.slice(1);let s,i;if(t&&(this.transformer=t),0===r){const n=this.execItem(o[0]);s=this.resolveKey(n),i="key"}else if(1===r){const n=this.execItem(o[0]),e=o[1];s=this.resolveCommand(n,e),i="command"}else if(2===r)s="",i="comment";else if(n.isArray(e)){const n=this.execArr(e).join("");s=this.transformer(n),i="array"}else s=e,i="string";return t&&(this.transformer=P),this.log(["item",i],s),s}execArr(n){const e=n.map(n=>this.execItem(n));return this.log(["array"],e),e}resolveCommand(n,e){if(!this.commands.has(n))return o(n,new Error("unknown command"));const t=this.commands.get(n)(this,e);return s(t,n)}resolveKey(e){const t=e.split(".");if(!this.keys.has(t[0]))return o(e,new Error("unknown key"));const r=this.keys.get(t[0]);let i,c=r;if(t.length>1){const s=t.slice(1);if(!n.hasPath(r,s))return o(e,new Error(`does not have '${s}'`));c=n.getPath(r,s)}return i=n.isFunction(c)?c():n.isObjectPlain(c)?c.__default:c,s(i,e)}};return class{constructor(e,t={},r={}){const o=n.objDefaultsDeep(t,u),s=n.objDefaultsDeep(r,f);this.commands=O(),o.loadJSON?this.tree=e:this.tree=new c(o,s).parseString(e)}addCommand(n,e){this.commands.set(n,e)}run(e=[],t={},r={},o={}){const s=n.objDefaultsDeep(r,a),i=n.objDefaults(o,f),c=C(e,t);return new Y(this.commands,c,s,i).execItem(this.tree)}}}(lightdash,pyslice,moment);
//# sourceMappingURL=yna.min.js.map
