var Yna=function(n,e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;const r=class{constructor(n,e,t){this.name=n,this.options=e,this.data=t}log(n,e){if(this.options.debug){const t=[this.name,...n].join("::");console.log(`${t}: ${JSON.stringify(e)}`)}}},o=(n,e)=>`<${n}:${e.message}>`,i=(e,t="unknown")=>{if(n.isString(e))return e;if(!0===e)return"True";if(!1===e)return"False";if(n.isNil(e))return"None";if(n.isError(e))return o(t,e);return String(e)},s=(n,e)=>{let t=0;n.split("").forEach((n,r)=>{const o={open:"{"===n,close:"}"===n};o.open?t++:o.close&&t--;e(n,r,t,o)});return t},c=class extends r{constructor(n,e){super("PARSER",n,e)}parseString(n,e=!0){const t=[];let r,i,c=0;const u=s(n,(e,r,o,i)=>{const s=n.substr(c,r-c);i.open&&1===o?(t.push(s),c=r):i.close&&0===o&&(t.push(this.parseBlock(s.substr(1,s.length-1))),c=r+1)});if(t.push(n.substr(c)),0!==u)r=o("parser",new Error("mismatched brackets")),i="error";else{const n=e?t.filter(n=>n.length>0):t;1===n.length?(r=n[0],i="single"):(r=n,i="mixed")}return this.log(["string",i],r),r}parseBlock(n){const e=n.trim();let t,r;if(e.startsWith("!")){const e="{"+n.replace("!","")+"}";t=[2,e],r="comment"}else if(e.startsWith(">")){const e="{"+n.replace(">","")+"}";t=e,r="escaped"}else if(e.endsWith(";")){const e=this.parseBlockData(n);t=[1,e.name,e.args],r="command"}else{const e=this.parseString(n);t=[0,e],r="key"}return this.log(["block",r],t),t}parseBlockData(n){const e=[],t={name:"",args:""};let r,i=0,c=!1;return 0!==s(n,(t,r,o)=>{if(0===o&&(";"===t||":"===t&&!c)){const o=this.parseString(n.substr(i,r-i),!0);e.push(o),i=r+1,":"===t&&(c=!0)}})?(t.name=e[0],t.args=o("parser",new Error("mismatched brackets")),r="error"):(t.name=e[0],t.args=e.slice(1),r="mixed"),this.log(["strData",r],t),t}},u=n=>n,a=class extends r{constructor(n,e,t,r){super("RUNNER",t,r),this.commands=n,this.keys=e,this.transformer=u}execItem(e,t){const r=e[0],o=e.slice(1);let i,s;if(t&&(this.transformer=t),0===r){const n=this.execItem(o[0]);i=this.resolveKey(n),s="key"}else if(1===r){const n=this.execItem(o[0]),e=o[1];i=this.resolveCommand(n,e),s="command"}else if(2===r)i="",s="comment";else if(n.isArray(e)){const n=this.execArr(e).join("");i=this.transformer(n),s="array"}else i=e,s="string";return t&&(this.transformer=u),this.log(["item",s],i),i}execArr(n){const e=n.map(n=>this.execItem(n));return this.log(["array"],e),e}resolveCommand(n,e){if(!this.commands.has(n))return o(n,new Error("unknown command"));const t=this.commands.get(n)(this,e);return i(t,n)}resolveKey(e){const t=e.split(".");if(!this.keys.has(t[0]))return o(e,new Error("unknown key"));const r=this.keys.get(t[0]);let s,c=r;if(t.length>1){const i=t.slice(1);if(!n.hasPath(r,i))return o(e,new Error(`does not have '${i}'`));c=n.getPath(r,i)}return s=n.isFunction(c)?c():n.isObjectPlain(c)?c.__default:c,i(s,e)}},f={debug:!1,loadJSON:!1},g={debug:!1,depth:0},h={},l=/^-?\d+\.\d+$/,m=n=>l.test(String(n)),p=/^<[a-z]+:[a-z0-9 ]+>$/,d=n=>p.test(n),w=n=>1===n.length,E=n=>n.split(","),b=n=>n.includes(","),y=/^-?\d+\.?\d*$/,x=parseFloat,R=n=>y.test(String(n)),v=n=>!n.includes(" "),I=n.mapFromObject({word:v,letter:w,number:R,decimal:m,error:d}),L=n.mapFromObject({eq:{type:"any",fn:(n,e)=>n===e},ne:{type:"any",fn:(n,e)=>n!==e},gt:{type:"number",fn:(n,e)=>n>e},ge:{type:"number",fn:(n,e)=>n>=e},lt:{type:"number",fn:(n,e)=>n<e},le:{type:"number",fn:(n,e)=>n<=e},in:{type:"any",fn:(n,e)=>{const t=b(e)?E(e):e;return t.includes(n)}},is:{type:"any",fn:(n,e)=>{const t=I.get(e);return t(n)}}}),S=n.mapFromObject({"=":"eq","==":"eq","!=":"ne","<>":"ne",">=":"ge",">":"gt","<=":"le","<":"lt"}),j=(n,e)=>{if(e.length<4||e.length>5)return new Error("invalid args");let t=n.execItem(e[0]);let r=n.execItem(e[2]);const o=n.execItem(e[1]);const i=()=>n.execItem(e[3]);const s=e[4]?()=>n.execItem(e[4]):()=>"";let c;if(L.has(o))c=L.get(o);else{if(!S.has(o))return new Error("invalid op");c=L.get(S.get(o))}if("number"===c.type){if(!R(t)||!R(r))return new Error("args must be numbers");t=x(t),r=x(r)}else if("is"===o&&!I.has(r))return new Error("invalid type name");return c.fn(t,r)?i():s()},k=Math.pow(2,32)-1,M=1-Math.pow(2,32),D=n.mapFromObject({add:{argsLengthRange:[2,1/0],fn:(...n)=>n.reduce((n,e)=>n+e)},sub:{argsLengthRange:[2,2],fn:(...n)=>n.reduce((n,e)=>n-e)},mul:{argsLengthRange:[2,1/0],fn:(...n)=>n.reduce((n,e)=>n*e)},pow:{argsLengthRange:[2,2],fn:Math.pow},div:{argsLengthRange:[2,2],fn:(n,e)=>0!==e?n/e:new Error("divide by zero")},idiv:{argsLengthRange:[2,2],fn:(n,e)=>0!==e?Math.floor(n/e):new Error("divide by zero")},mod:{argsLengthRange:[2,2],fn:(n,e)=>n%e},and:{argsLengthRange:[2,1/0],fn:(...n)=>[-1,...n].reduce((n,e)=>n&e)},or:{argsLengthRange:[2,1/0],fn:(...n)=>[0,...n].reduce((n,e)=>n|e)},xor:{argsLengthRange:[2,2],fn:(n,e)=>n^e},not:{argsLengthRange:[1,1],fn:n=>~n},round:{argsLengthRange:[1,1],fn:Math.round},floor:{argsLengthRange:[1,1],fn:Math.floor},ceil:{argsLengthRange:[1,1],fn:Math.ceil},max:{argsLengthRange:[2,1/0],fn:Math.max},min:{argsLengthRange:[2,1/0],fn:Math.min}}),O=n.mapFromObject({"+":"add","-":"sub","*":"mul","**":"pow","/":"div","/f":"div","//":"idiv","%":"mod","&":"and","|":"or","^":"xor","~":"not"}),A=(n,e)=>{if(0===e.length)return new Error("no args");const t=n.execItem(e[0]);const r=e.slice(1);let o;let i;let s;if(D.has(t))o=D.get(t);else{if(!O.has(t))return new Error("unknown operation");o=D.get(O.get(t))}if(!(r.length>=o.argsLengthRange[0]&&r.length<=o.argsLengthRange[1]))return new Error("invalid args");i=n.execArr(r);if(i.some(n=>!R(n)))return new Error("non-number args");i=i.map(x);s=o.fn(...i);if(s>k)return new Error("inf");if(s<M)return new Error("-inf");return s},F=(e,t)=>{if(0===t.length)return new Error("no options");const r=e.execArr(t);return n.randItem(r)},N=(e,t)=>{if(0===t.length)return new Error("no args");const r=e.execArr(t);if(!r.every(R))return new Error("invalid args");let o=0;let i=100;let s=1;1===r.length?i=x(r[0]):(o=x(r[0]),i=x(r[1]));3===r.length&&(s=x(r[2]));if(o===i||0===s)return new Error("invalid range");const c=n.randNumber(o,i,!Number.isInteger(s));return Math.floor(c/s)*s},z=(e,t)=>{if(0===t.length)return new Error("no options");if(t.length%2!=0)return new Error("mismatched weighting");const r=e.execArr(t);const o=[];const i=[];let s=!0;r.forEach((n,e)=>{e%2==0?i.push(n):R(n)?o.push(x(n)):s=!1});if(!s)return new Error("invalid weight");const c=[];o.forEach((n,e)=>{const t=i[e];const r=new Array(n).fill(t);c.push(...r)});return n.randItem(c)},C=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.length},P=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.toLowerCase()},Y=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return encodeURI(t)},U=(n,e)=>{if(0===e.length)return new Error("no content");if(3!==e.length)return new Error("invalid args");const t=n.execArr(e);const r=n.keys.get("newrep");const o=t[0];const i=r?t[2]:t[1];const s=r?t[1]:t[2];const c=new RegExp(o,"g");return i.replace(c,s)},W=(n,t)=>{if(0===t.length)return new Error("no args");if(2!==t.length)return new Error("bad content");const r=n.execArr(t);const o=r[1];const i=b(r[0])?E(r[0]):[r[0]];if(i.length>3)return new Error("too many nums");if(!i.every(n=>R(n)||""===n))return new Error("non int index");const s=i.map(n=>""!==n&&x(n));if(0===s[2])return new Error("zero step");return!1===s[2]?e(o,s[0],s[1]):e(o,s[0],s[1],s[2])},q=/\s/,J=n=>{let e=!0;return n.split("").map(n=>{const t=q.test(n);let r=n.toLowerCase();e&&!t&&(e=!1,r=n.toUpperCase());e=t;return r}).join("")},$=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return J(t)},B=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.toUpperCase()},H=n=>{let e=n.trimLeft();n.endsWith("\\")&&(e=e.substr(0,e.length-"\\".length)+"\\n");return e},_=n=>{const e=n.split("\n").map(n=>H(n)).join("");return e.replace(/\\n/g,"\n")},K=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0],_);return _(t)},T=(n,e)=>{n.execItem(e[0]);return""},G=()=>{const e=n.mapFromObject({when:j,math:A,len:C,upper:B,lower:P,title:$,rep:U,parse:Y,slice:W,num:N,choose:F,wchoose:z,oneline:K,void:T});return e},Q=n=>t.utc(n).format("YYYY-MM-DD HH:mm:ss:SSSSSS"),V=(e,r)=>{const o=new Map;o.set("time",Q(t.utc()));o.set("newrep",!1);o.set("args",e.join(" "));o.set("arglen",e.length);e.forEach((n,e)=>{o.set(`arg${e+1}`,n)});n.forEachEntry(r,(n,e)=>{o.set(e,n)});return o};return class{constructor(e,t={},r={}){const o=n.objDefaultsDeep(t,f),i=n.objDefaultsDeep(r,h);this.commands=G(),o.loadJSON?this.tree=e:this.tree=new c(o,i).parseString(e)}addCommand(n,e){this.commands.set(n,e)}run(e=[],t={},r={},o={}){const i=n.objDefaultsDeep(r,g),s=n.objDefaults(o,h),c=V(e,t);return new a(this.commands,c,i,s).execItem(this.tree)}}}(lightdash,pyslice,moment);
//# sourceMappingURL=yna.min.js.map
