var Yna=function(n,e,t,r){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r;const o=class{constructor(n,e,t){this.name=n,this.options=e,this.data=t}log(n,e){if(this.options.debug){const t=[this.name,...n].join("::");console.log(`${t}: ${JSON.stringify(e)}`)}}},i=(n,e)=>`<${n}:${e.message}>`,s=(e,t="unknown")=>{if(n.isString(e))return e;if(!0===e)return"True";if(!1===e)return"False";if(n.isNil(e))return"None";if(n.isError(e))return i(t,e);return String(e)},c=(n,e)=>{let t=0;n.split("").forEach((n,r)=>{const o={open:"{"===n,close:"}"===n};o.open?t++:o.close&&t--;e(n,r,t,o)});return t},u=class extends o{constructor(n,e){super("PARSER",n,e)}parseString(n,e=!0){const t=[];let r,o,s=0;const u=c(n,(e,r,o,i)=>{const c=n.substr(s,r-s);i.open&&1===o?(t.push(c),s=r):i.close&&0===o&&(t.push(this.parseBlock(c.substr(1,c.length-1))),s=r+1)});if(t.push(n.substr(s)),0!==u)r=i("parser",new Error("mismatched brackets")),o="error";else{const n=e?t.filter(n=>n.length>0):t;1===n.length?(r=n[0],o="single"):(r=n,o="mixed")}return this.log(["string",o],r),r}parseBlock(n){const e=n.trim();let t,r;if(e.startsWith("!")){const e="{"+n.replace("!","")+"}";t=[2,e],r="comment"}else if(e.startsWith(">")){const e="{"+n.replace(">","")+"}";t=e,r="escaped"}else if(e.endsWith(";")){const e=this.parseBlockData(n);t=[1,e.name,e.args],r="command"}else{const e=this.parseString(n);t=[0,e],r="key"}return this.log(["block",r],t),t}parseBlockData(n){const e=[],t={name:"",args:""};let r,o=0,s=!1;return 0!==c(n,(t,r,i)=>{if(0===i&&(";"===t||":"===t&&!s)){const i=this.parseString(n.substr(o,r-o),!0);e.push(i),o=r+1,":"===t&&(s=!0)}})?(t.name=e[0],t.args=i("parser",new Error("mismatched brackets")),r="error"):(t.name=e[0],t.args=e.slice(1),r="mixed"),this.log(["strData",r],t),t}},f=n=>n,a=class extends o{constructor(n,e,t,r){super("RUNNER",t,r),this.depth=0,this.commands=n,this.keys=e,this.transformer=f}execItem(e,t){const r=e[0],o=e.slice(1);let i,s;if(t&&(this.transformer=t),0===r){const n=this.execItem(o[0]);i=this.resolveKey(n),s="key"}else if(1===r){const n=this.execItem(o[0]),e=o[1];i=this.resolveCommand(n,e),s="command"}else if(2===r)i="",s="comment";else if(n.isArray(e)){const n=this.execArr(e).join("");i=this.transformer(n),s="array"}else i=e,s="string";return t&&(this.transformer=f),this.log(["item",s],i),i}execArr(n){const e=n.map(n=>this.execItem(n));return this.log(["array"],e),e}resolveCommand(n,e){if(!this.commands.has(n))return i(n,new Error("unknown command"));const t=this.commands.get(n)(this,e);return s(t,n)}resolveKey(e){const t=e.split(".");if(!this.keys.has(t[0]))return i(e,new Error("unknown key"));const r=this.keys.get(t[0]);let o,c=r;if(t.length>1){const o=t.slice(1);if(!n.hasPath(r,o))return i(e,new Error(`does not have '${o}'`));c=n.getPath(r,o)}return o=n.isFunction(c)?c():n.isObjectPlain(c)?c.__default:c,s(o,e)}},g={debug:!1,loadJSON:!1},h={debug:!1},l={},m=Math.pow(2,32)-1,d=1-Math.pow(2,32),p=/^[a-z_][0-9a-z_]*$/i,w=n=>p.test(n),E=n=>n.replace("\n","\\\\n"),y=(n,e)=>{if(0===e.length)return new Error("no args");if(2!==e.length)return new Error("invalid args");const t=n.execItem(e[0]);if(!w(t))return new Error("invalid key");const r=()=>{let t;n.depth++;if(n.depth>15)return new Error("max recursion depth exceeded");t=E(n.transformer(n.execItem(e[1])));n.depth--;return t};n.keys.set(t,r);return""},x=(n,e)=>{if(0===e.length)return new Error("no args");if(2!==e.length)return new Error("invalid args");const t=n.execArr(e);const r=t[0];if(!w(r))return new Error("invalid key");const o=E(n.transformer(t[1]));n.keys.set(r,o);return""},b=/^-?\d+\.?\d*$/,v=parseFloat,I=n=>b.test(String(n)),R=/^[+-]?[0-9]+$/,L=n=>R.test(String(n)),k=(n,t="%H:%M")=>e(n,t),S=(n,e)=>{let r=t.utc();const o=e[0]?n.execItem(e[0]):"0";if(!L(o))return new Error("invalid offset");const i=v(o);const s=e[1]?n.execItem(e[1]):"%H:%M";r=r.utcOffset(i);return k(r,s)},j=/^-?\d+\.\d+$/,M=n=>j.test(String(n)),O=/^<[a-z]+:[a-z0-9 ]+>$/,A=n=>O.test(n),D=n=>1===n.length,F=n=>n.split(","),N=n=>n.includes(","),z=n=>!n.includes(" "),P=n.mapFromObject({word:z,letter:D,number:I,decimal:M,error:A}),C=n.mapFromObject({eq:{type:"any",fn:(n,e)=>n===e},ne:{type:"any",fn:(n,e)=>n!==e},gt:{type:"number",fn:(n,e)=>n>e},ge:{type:"number",fn:(n,e)=>n>=e},lt:{type:"number",fn:(n,e)=>n<e},le:{type:"number",fn:(n,e)=>n<=e},in:{type:"any",fn:(n,e)=>{const t=N(e)?F(e):e;return t.includes(n)}},is:{type:"any",fn:(n,e)=>{const t=P.get(e);return t(n)}}}),Y=n.mapFromObject({"=":"eq","==":"eq","!=":"ne","<>":"ne",">=":"ge",">":"gt","<=":"le","<":"lt"}),$=(n,e)=>{if(e.length<4||e.length>5)return new Error("invalid args");let t=n.execItem(e[0]);let r=n.execItem(e[2]);const o=n.execItem(e[1]);const i=()=>n.execItem(e[3]);const s=e[4]?()=>n.execItem(e[4]):()=>"";let c;if(C.has(o))c=C.get(o);else{if(!Y.has(o))return new Error("invalid op");c=C.get(Y.get(o))}if("number"===c.type){if(!I(t)||!I(r))return new Error("args must be numbers");t=v(t),r=v(r)}else if("is"===o&&!P.has(r))return new Error("invalid type name");return c.fn(t,r)?i():s()},H=n.mapFromObject({add:{argsLengthRange:[2,1/0],fn:(...n)=>n.reduce((n,e)=>n+e)},sub:{argsLengthRange:[2,2],fn:(...n)=>n.reduce((n,e)=>n-e)},mul:{argsLengthRange:[2,1/0],fn:(...n)=>n.reduce((n,e)=>n*e)},pow:{argsLengthRange:[2,2],fn:Math.pow},div:{argsLengthRange:[2,2],fn:(n,e)=>0!==e?n/e:new Error("divide by zero")},idiv:{argsLengthRange:[2,2],fn:(n,e)=>0!==e?Math.floor(n/e):new Error("divide by zero")},mod:{argsLengthRange:[2,2],fn:(n,e)=>n%e},and:{argsLengthRange:[2,1/0],fn:(...n)=>[-1,...n].reduce((n,e)=>n&e)},or:{argsLengthRange:[2,1/0],fn:(...n)=>[0,...n].reduce((n,e)=>n|e)},xor:{argsLengthRange:[2,2],fn:(n,e)=>n^e},not:{argsLengthRange:[1,1],fn:n=>~n},round:{argsLengthRange:[1,1],fn:Math.round},floor:{argsLengthRange:[1,1],fn:Math.floor},ceil:{argsLengthRange:[1,1],fn:Math.ceil},max:{argsLengthRange:[2,1/0],fn:Math.max},min:{argsLengthRange:[2,1/0],fn:Math.min}}),U=n.mapFromObject({"+":"add","-":"sub","*":"mul","**":"pow","/":"div","/f":"div","//":"idiv","%":"mod","&":"and","|":"or","^":"xor","~":"not"}),W=(n,e)=>{if(0===e.length)return new Error("no args");const t=n.execItem(e[0]);const r=e.slice(1);let o;let i;let s;if(H.has(t))o=H.get(t);else{if(!U.has(t))return new Error("unknown operation");o=H.get(U.get(t))}if(!(r.length>=o.argsLengthRange[0]&&r.length<=o.argsLengthRange[1]))return new Error("invalid args");i=n.execArr(r);if(i.some(n=>!I(n)))return new Error("non-number args");i=i.map(v);s=o.fn(...i);if(s>m)return new Error("inf");if(s<d)return new Error("-inf");return s},_=(e,t)=>{if(0===t.length)return new Error("no options");const r=e.execArr(t);return n.randItem(r)},q=(e,t)=>{if(0===t.length)return new Error("no args");const r=e.execArr(t);if(!r.every(I))return new Error("invalid args");let o=0;let i=100;let s=1;1===r.length?i=v(r[0]):(o=v(r[0]),i=v(r[1]));3===r.length&&(s=v(r[2]));if(o===i||0===s)return new Error("invalid range");const c=n.randNumber(o,i,!Number.isInteger(s));return Math.floor(c/s)*s},J=(e,t)=>{if(0===t.length)return new Error("no options");if(t.length%2!=0)return new Error("mismatched weighting");const r=e.execArr(t);const o=[];const i=[];let s=!0;r.forEach((n,e)=>{e%2==0?i.push(n):I(n)?o.push(v(n)):s=!1});if(!s)return new Error("invalid weight");const c=[];o.forEach((n,e)=>{const t=i[e];const r=new Array(n).fill(t);c.push(...r)});return n.randItem(c)},B=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.length},K=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.toLowerCase()},T=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return encodeURI(t)},G=(n,e)=>{if(0===e.length)return new Error("no content");if(3!==e.length)return new Error("invalid args");const t=n.execArr(e);const r=n.keys.get("newrep");const o=t[0];const i=r?t[2]:t[1];const s=r?t[1]:t[2];const c=new RegExp(o,"g");return i.replace(c,s)},Q=(n,e)=>{if(0===e.length)return new Error("no args");if(2!==e.length)return new Error("bad content");const t=n.execArr(e);const o=t[1];const i=N(t[0])?F(t[0]):[t[0]];if(i.length>3)return new Error("too many nums");if(!i.every(n=>I(n)||""===n))return new Error("non int index");const s=i.map(n=>""!==n&&v(n));if(0===s[2])return new Error("zero step");return!1===s[2]?r(o,s[0],s[1]):r(o,s[0],s[1],s[2])},V=/\s/,X=n=>{let e=!0;return n.split("").map(n=>{const t=V.test(n);let r=n.toLowerCase();e&&!t&&(e=!1,r=n.toUpperCase());e=t;return r}).join("")},Z=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return X(t)},nn=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0]);return t.toUpperCase()},en=n=>{let e=n.trimLeft();n.endsWith("\\")&&(e=e.substr(0,e.length-"\\".length)+"\\n");return e},tn=n=>{const e=n.split("\n").map(n=>en(n)).join("");return e.replace(/\\n/g,"\n")},rn=(n,e)=>{if(0===e.length)return new Error("no content");const t=n.execItem(e[0],tn);return tn(t)},on=(n,e)=>{n.execItem(e[0]);return""},sn=()=>{const e=n.mapFromObject({set:x,func:y,time:S,when:$,math:W,len:B,upper:nn,lower:K,title:Z,rep:G,parse:T,slice:Q,num:q,choose:_,wchoose:J,oneline:rn,void:on});return e},cn=n=>n.format("YYYY-MM-DD HH:mm:ss:SSSSSS"),un=(e,r)=>{const o=new Map;o.set("time",cn(t.utc()));o.set("newrep",!1);o.set("args",e.join(" "));o.set("arglen",e.length);e.forEach((n,e)=>{o.set(`arg${e+1}`,n)});n.forEachEntry(r,(n,e)=>{o.set(e,n)});return o};return class{constructor(e,t={},r={}){const o=n.objDefaultsDeep(t,g),i=n.objDefaultsDeep(r,l);this.commands=sn(),o.loadJSON?this.tree=e:this.tree=new u(o,i).parseString(e)}addCommand(n,e){this.commands.set(n,e)}run(e=[],t={},r={},o={}){const i=n.objDefaultsDeep(r,h),s=n.objDefaults(o,l),c=un(e,t);return new a(this.commands,c,i,s).execItem(this.tree)}}}(lightdash,pydateformat,moment,pyslice);
//# sourceMappingURL=yna.min.js.map
